# Configuración de Apache Virtual Host para chequeos.grupozafra.com.ar

<VirtualHost *:80>
    ServerName chequeos.grupozafra.com.ar
    DocumentRoot /var/www/chequeos.grupozafra.com.ar/cliente/dist
    
    # Proxy para API del backend
    ProxyPreserveHost On
    ProxyPass /api/ http://localhost:5000/api/
    ProxyPassReverse /api/ http://localhost:5000/api/
    
    # Configuración para SPA (Single Page Application)
    <Directory /var/www/chequeos.grupozafra.com.ar/cliente/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Redirigir todas las rutas a index.html para React Router
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Headers de seguridad
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/chequeos_error.log
    CustomLog ${APACHE_LOG_DIR}/chequeos_access.log combined
</VirtualHost>

# Configuración HTTPS (después de obtener certificado SSL)
<VirtualHost *:443>
    ServerName chequeos.grupozafra.com.ar
    DocumentRoot /var/www/chequeos.grupozafra.com.ar/cliente/dist
    
    # Proxy para API del backend
    ProxyPreserveHost On
    ProxyPass /api/ http://localhost:5000/api/
    ProxyPassReverse /api/ http://localhost:5000/api/
    
    # Configuración SSL
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/chequeos.grupozafra.com.ar/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/chequeos.grupozafra.com.ar/privkey.pem
    
    # Configuración para SPA
    <Directory /var/www/chequeos.grupozafra.com.ar/cliente/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # Headers de seguridad
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/chequeos_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/chequeos_ssl_access.log combined
</VirtualHost>